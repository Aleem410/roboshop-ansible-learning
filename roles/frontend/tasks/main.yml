- name: install nginx
  ansible.builtin.yum:
    name: nginx
    state: installed

- name: Add application user
  when: APP_USER is defined
  ansible.builtin.user:
    name: "{{ APP_USER }}"



- name: Download app content
  ansible.builtin.get_url:
    url: https://github.com/roboshop-devops-project/{{ COMPONENT }}/archive/main.zip
    dest: /tmp/{{ COMPONENT }}.zip

- name: remove previous app version
  ansible.builtin.file:
    path: "{{ APP_LOC }}"
    state: absent


- name: download and extracting app contect
  ansible.builtin.unarchive:
    src: https://github.com/roboshop-devops-project/{{ COMPONENT }}/archive/main.zip
    dest: "/tmp"
    remote_src: yes

- name: copy extract content to location
  ansible.builtin.copy:
    src: /tmp/{{ COMPONENT }}-main
    dest: "{{ APP_LOC }}"
    remote_src: yes

#
#  PRINT "extracting app content"
#  unzip -o /tmp/${COMPONENT}.zip &>>$LOG
#  STAT $?
#  COMPONENT=frontend
#  source common.sh

#
#  APP_LOC=/usr/share/nginx/html
#
#  DOWNLOAD_APP_CODE
#
#  mv frontend-main/static/* . &>>{LOG}
#  mv frontend-main/localhost.conf /etc/nginx/default.d/roboshop.conf &>>{LOG}
#
#  PRINT "Update RoboShop Configuration"
#  sed -i -e '/catalogue/ s/localhost/dev-catalogue.mydevops410.online/' -e '/user/ s/localhost/dev-user.mydevops410.online/' -e '/cart/ s/localhost/dev-cart.mydevops410.online/' -e '/shipping/ s/localhost/dev-shipping.mydevops410.online/' -e '/payment/ s/localhost/dev-payment.mydevops410.online/' /etc/nginx/default.d/roboshop.conf
#  STAT $?
#
#  PRINT "enable nginx"
#  systemctl enable nginx &>>{LOG}
#  STAT $?
#
#  PRINT "restart nginx"
#  systemctl restart nginx &>>{LOG}
#  STAT $?
#- name: start nginx
#  ansible.builtin.service:
#    name: nginx
#    state: started
#    enabled: yes
#
#- name: download nginx docs
#
#      ansible.builtin.shell: curl -s -L -o /tmp/frontend.zip "https://github.com/roboshop-devops-project/frontend/archive/main.zip"
#
#- name: remove existing content
#  hosts: localhost
#  tasks:
#    - name: remove file
#      ansible.builtin.file:
#        path: /usr/share/nginx/html
#        state: absent
#
#- name: Unarchive a file that is already
#  hosts: localhost
#  tasks:
#    - name: unarchieve file
#      ansible.builtin.unarchive:
#        src: https://github.com/roboshop-devops-project/frontend/archive/main.zip
#        dest: "/tmp"
#        remote_src: yes
#
#- name: copy to roboshop configuration
#  hosts: localhost
#  tasks:
#    - name: copy roboshop content
#      ansible.builtin.copy:
#        src: /tmp/frontend-main/localhost.conf
#        dest: /etc/nginx/default.d/roboshop.conf
#        remote_src: yes
